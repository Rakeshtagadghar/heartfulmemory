{
  "meta": {
    "sprint": 6,
    "title": "WYSIWYG Page Layout System v1 (Canva-like Editor Shell + Page Templates)",
    "duration": "1 week",
    "goal": "Make the editor match the output: full-page canvas with page thumbnails, frame-based layout, and template-driven pages so users can immediately visualize the final PDF.",
    "coreDecision": {
      "exports": ["DIGITAL_PDF", "HARDCOPY_PRINT_PDF"],
      "mediaEnabledNow": ["TEXT", "IMAGE"],
      "mediaDisabledNow": ["VIDEO", "GIF"]
    },
    "definitionOfDone": [
      "Full-width Canva-like editor shell shipped (canvas center, controls at corners)",
      "Page model introduced (pages + frames) stored in Convex",
      "Template-driven page layouts available (guided mode) + basic freeform frame editing",
      "On-canvas WYSIWYG preview accurately reflects final PDF constraints (margins/grid)",
      "Basic image frame placement + crop UI stub (no uploads yet if you want)",
      "Ready for Sprint 7: layout-to-PDF renderer consumes the same page model"
    ]
  },
  "tasks": [
    {
      "id": "S6-T01",
      "title": "Introduce canonical document model: Pages + Frames (single source of truth)",
      "skill": ["Architecture", "TypeScript", "Convex Schema"],
      "priority": "P0",
      "requirements": {
        "dataModel": {
          "page": [
            "id",
            "storybookId",
            "orderIndex",
            "sizePreset",
            "margins",
            "grid",
            "background"
          ],
          "frame": [
            "id",
            "pageId",
            "type: TEXT|IMAGE",
            "x,y,w,h (in px at a fixed canvas DPI or in points/mm)",
            "zIndex",
            "style (font, size, lineHeight, align)",
            "contentRef (textDoc OR assetRef)",
            "crop/focalPoint (for IMAGE)"
          ]
        },
        "constraints": [
          "Everything must be representable as frames; blocks become implementation detail",
          "Must support both guided templates and freeform editing",
          "No VIDEO/GIF fields yet (leave extensibility hooks)"
        ]
      },
      "acceptanceTests": [
        "A storybook can have multiple pages with ordered frames",
        "Frames persist and reload correctly",
        "Schema supports print-safe margins and grid metadata"
      ],
      "deliverables": [
        "convex/schema.ts (pages, frames)",
        "convex/pages.ts, convex/frames.ts (CRUD)",
        "packages/shared-schema/pageFrame.types.ts"
      ]
    },
    {
      "id": "S6-T02",
      "title": "Build Canva-like Editor Shell (full screen canvas + corner controls)",
      "skill": ["Frontend", "UX", "Layout"],
      "priority": "P0",
      "requirements": {
        "layout": [
          "Left: Pages panel (thumbnails + add page)",
          "Center: Canvas (zoom/pan)",
          "Top bar: file/export placeholders + undo/redo",
          "Right: Properties panel (selected frame styles)",
          "Floating corner controls: zoom %, snap/grid toggle, page size selector"
        ],
        "behavior": [
          "Canvas always gets maximum space",
          "Selection + keyboard shortcuts (delete, copy/paste frame, arrow nudge)"
        ],
        "constraints": [
          "Must feel clean like Canva: controls in corners, minimal clutter"
        ]
      },
      "acceptanceTests": [
        "User can switch pages via thumbnails",
        "Canvas zoom and pan are smooth",
        "Selected frame shows properties panel"
      ],
      "deliverables": [
        "components/editor2/EditorShell.tsx",
        "components/editor2/PagesPanel.tsx",
        "components/editor2/CanvasStage.tsx",
        "components/editor2/PropertiesPanel.tsx"
      ]
    },
    {
      "id": "S6-T03",
      "title": "Guided Templates v1: page layout library (elders-first) + apply flow",
      "skill": ["Product", "Frontend", "Convex"],
      "priority": "P0",
      "requirements": {
        "templateLibrary": [
          "Cover: Title + subtitle + hero image",
          "TOC page: list + side image strip",
          "Chapter opener: big title + hero image",
          "Story page A: 70/30 text + image",
          "Story page B: 2-column text + 2 images",
          "Gallery page: 2x3 grid"
        ],
        "applyFlow": [
          "Pick template -> generates pages + frames with locked positions",
          "Allow simple safe tweaks: swap image, edit text, crop"
        ],
        "constraints": [
          "Frames can be locked in guided mode (position locked, content editable)",
          "Template metadata includes min/max text length per text frame"
        ]
      },
      "acceptanceTests": [
        "Applying a template generates pages that look “book-like” immediately",
        "Locked frames cannot be dragged in guided mode",
        "Users can still edit text/images inside frames"
      ],
      "deliverables": [
        "content/pageTemplates/*.ts",
        "convex/templates.applyPageTemplate.ts",
        "components/editor2/TemplatePicker.tsx"
      ]
    },
    {
      "id": "S6-T04",
      "title": "Freeform Frames v1: add/move/resize text & image frames (Canva-lite)",
      "skill": ["Frontend", "Canvas Interaction"],
      "priority": "P0",
      "requirements": {
        "actions": [
          "Add Text Frame",
          "Add Image Frame (placeholder)",
          "Drag to move",
          "Resize handles",
          "Snap to grid/margins",
          "Layer order: bring forward/back"
        ],
        "implementationHint": [
          "Use Konva/Fabric.js or pure DOM with absolute positioned divs (choose one and stick)",
          "Keep frame geometry stored in canonical model"
        ]
      },
      "acceptanceTests": [
        "Frame moves/resizes persist to Convex",
        "Snap-to-grid works and can be toggled",
        "Z-index changes reflected visually"
      ],
      "deliverables": [
        "components/editor2/FrameRenderer.tsx",
        "components/editor2/FrameHandles.tsx",
        "lib/editor2/snap.ts"
      ]
    },
    {
      "id": "S6-T05",
      "title": "WYSIWYG print guides: margins, safe area, grid overlay, page sizes",
      "skill": ["UX", "Print Layout", "Frontend"],
      "priority": "P0",
      "requirements": {
        "pageSizes": ["A4", "US Letter", "6x9 (book)", "8.5x11 (book)"],
        "overlays": [
          "Margins/safe area",
          "Optional columns grid",
          "Bleed placeholder (future hardcopy)"
        ],
        "constraints": [
          "Overlays must not affect exported content (render-only)",
          "Store chosen page size in storybook settings"
        ]
      },
      "acceptanceTests": [
        "Changing page size updates canvas scaling and overlays",
        "Margins are always visible and consistent",
        "Frames outside safe area show warning outline"
      ],
      "deliverables": [
        "components/editor2/GuidesOverlay.tsx",
        "convex/storybooks.updateSettings (pageSize, margins, grid)"
      ]
    },
    {
      "id": "S6-T06",
      "title": "Text rendering spec for PDF parity (fonts, line-height, wrapping rules)",
      "skill": ["Typography", "Architecture"],
      "priority": "P1",
      "requirements": {
        "rules": [
          "Limit to 1–2 font families (embed later for PDF parity)",
          "Define font scale (H1/H2/body/caption)",
          "Define line-height and max line length per template frame",
          "Overflow behavior: show 'Text overflow' warning for a frame"
        ],
        "constraints": [
          "Must match what the PDF renderer will use in Sprint 7",
          "Avoid rich text features you can’t render predictably in PDF yet"
        ]
      },
      "acceptanceTests": [
        "Text frame shows overflow warning when content exceeds frame",
        "Template frames have sensible defaults and readability"
      ],
      "deliverables": [
        "docs/typography_spec.md",
        "lib/editor2/textMetrics.ts (stub/plan)"
      ]
    },
    {
      "id": "S6-T07",
      "title": "Autosave + collaboration safety adapted to pages/frames model",
      "skill": ["Frontend", "Convex", "Resilience"],
      "priority": "P0",
      "requirements": {
        "autosave": [
          "Debounce updates for frame geometry and text edits",
          "Save status indicator (Saving/Saved/Error)",
          "Versioning per frame (or updatedAt checks) to avoid cross-tab overwrites"
        ],
        "constraints": [
          "Do not spam Convex mutations during drag/resize (throttle)",
          "Conflict UI: reload/overwrite"
        ]
      },
      "acceptanceTests": [
        "Dragging a frame doesn’t produce excessive writes",
        "Cross-tab edits trigger a safe conflict notification",
        "No data loss on refresh"
      ],
      "deliverables": [
        "convex/frames.update (supports expectedVersion)",
        "lib/editor2/autosaveFrames.ts",
        "components/editor2/SaveStatus.tsx"
      ]
    },
    {
      "id": "S6-T08",
      "title": "Mode selection: user can enable BOTH Digital + Hardcopy outputs (no video/gif)",
      "skill": ["Product", "Frontend", "Convex"],
      "priority": "P1",
      "requirements": {
        "settings": [
          "exportTargets: { digitalPdf: true/false, printPdf: true/false }",
          "printConstraints: static-only enforced (already true since only TEXT/IMAGE enabled)"
        ],
        "ui": [
          "Export targets selector in book settings",
          "Explain difference: digital can include links later; print is static"
        ]
      },
      "acceptanceTests": [
        "User can toggle both targets and settings persist",
        "UI reflects selected targets consistently"
      ],
      "deliverables": [
        "components/storybooks/ExportTargetsToggle.tsx",
        "convex/storybooks.updateSettings"
      ]
    },
    {
      "id": "S6-T09",
      "title": "QA checklist + visual parity checks (editor looks like a book)",
      "skill": ["QA", "UX"],
      "priority": "P0",
      "requirements": {
        "checks": [
          "Template apply yields immediately readable pages",
          "Frames align to grid/margins",
          "Thumbnails match canvas content",
          "Text overflow warnings trigger correctly",
          "Autosave stable during drag/resize"
        ]
      },
      "acceptanceTests": [
        "No major UX confusion: user can ‘see the final book’ while editing",
        "No regressions to Sprint 5 create/edit flows"
      ],
      "deliverables": ["docs/qa_checklist_s6.md"]
    },
    {
      "id": "S6-T10",
      "title": "Release Sprint 6: deploy editor shell + page model",
      "skill": ["Release", "DevOps-lite", "Convex"],
      "priority": "P0",
      "requirements": {
        "releaseChecklist": [
          "Create storybook → apply page template",
          "Edit text in frames → refresh persists",
          "Move/resize frame → persists",
          "Switch page sizes → overlays correct",
          "Confirm only TEXT/IMAGE available"
        ]
      },
      "acceptanceTests": [
        "WYSIWYG editor is live and usable",
        "Data model supports Sprint 7 PDF rendering without rework"
      ],
      "deliverables": ["docs/release_checklist_s6.md"]
    }
  ]
}
